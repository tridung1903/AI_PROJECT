<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FoodScan Restaurant - Nh√† h√†ng th√¥ng minh</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #4CAF50;
      --primary-dark: #388E3C;
      --primary-light: #C8E6C9;
      --secondary: #8D6E63;
      --secondary-light: #D7CCC8;
      --accent: #FF9800;
      --text-dark: #333333;
      --text-light: #757575;
      --background: #F5F5F5;
      --white: #FFFFFF;
      --success: #4CAF50;
      --warning: #FFC107;
      --error: #F44336;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--background);
      color: var(--text-dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* === HEADER === */
    .app-header {
      background: var(--white);
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      font-size: 2.5em;
    }

    .logo-text h1 {
      font-size: 1.5em;
      color: var(--primary-dark);
      margin-bottom: 5px;
    }

    .logo-text p {
      font-size: 0.9em;
      color: var(--text-light);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-weight: 600;
      font-size: 1.2em;
    }

    .points-badge {
      background: linear-gradient(135deg, var(--accent) 0%, #FFB74D 100%);
      color: var(--text-dark);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1em;
      box-shadow: 0 2px 8px rgba(255, 167, 38, 0.3);
    }

    .btn-logout {
      padding: 8px 20px;
      background: var(--error);
      color: var(--white);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-logout:hover {
      background: #c82333;
      transform: translateY(-2px);
    }

    /* === NAVIGATION === */
    .nav-tabs {
      display: flex;
      background: var(--white);
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      overflow-x: auto;
      border-bottom: 1px solid var(--secondary-light);
    }

    .tab-btn {
      flex: 1;
      padding: 15px 20px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      color: var(--text-light);
      border-bottom: 3px solid transparent;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .tab-btn.active {
      color: var(--primary-dark);
      border-bottom-color: var(--primary-dark);
      background-color: var(--primary-light);
    }

    .tab-btn:hover:not(.active) {
      background-color: rgba(0,0,0,0.03);
    }

    /* === MAIN CONTENT === */
    .tab-content {
      display: none;
      padding: 30px 0;
      animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .section-title {
      font-size: 1.5em;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* === SCAN PAGE === */
    .scan-area {
      background: var(--white);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .camera-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto 20px;
      background: #f5f5f5;
      border-radius: 15px;
      overflow: hidden;
      aspect-ratio: 4/3;
      border: 2px dashed var(--primary-light);
    }

    #preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .camera-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
    }

    .btn-secondary {
      background: var(--secondary-light);
      color: var(--text-dark);
    }

    .btn-secondary:hover {
      background: var(--secondary);
      color: var(--white);
      transform: translateY(-2px);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .image-controls {
      margin-top: 15px;
      padding: 15px;
      background: var(--primary-light);
      border-radius: 10px;
      display: none;
    }

    .image-controls h4 {
      margin-bottom: 15px;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .control-item label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-item input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e0e0e0;
      outline: none;
    }

    .control-item input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }

    .control-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .results-area {
      margin-top: 30px;
    }

    .food-item {
      background: var(--white);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid var(--primary);
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .food-item h3 {
      color: var(--primary-dark);
      margin-bottom: 5px;
    }

    .food-price {
      font-weight: 600;
      color: var(--success);
      font-size: 1.1em;
    }

    .total-summary {
      margin-top: 20px;
      padding: 25px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 15px;
      color: var(--white);
      box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 10px;
    }

    /* === MENU PAGE === */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .menu-card {
      background: var(--white);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: all 0.3s;
    }

    .menu-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .menu-card-img {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .menu-card-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .menu-card-body {
      padding: 20px;
    }

    .menu-card-title {
      font-size: 1.2em;
      color: var(--text-dark);
      margin-bottom: 10px;
      font-weight: 600;
    }

    .menu-card-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-light);
      font-size: 0.95em;
      margin-top: 10px;
    }

    .menu-price {
      color: var(--primary-dark);
      font-weight: 700;
      font-size: 1.1em;
    }

    /* === REWARDS PAGE === */
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .reward-card {
      background: var(--white);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: all 0.3s;
      text-align: center;
    }

    .reward-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .reward-icon {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      overflow: hidden;
      font-size: 3em;
    }

    .reward-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .reward-title {
      font-size: 1.3em;
      margin-bottom: 10px;
      color: var(--text-dark);
      font-weight: 600;
    }

    .reward-points {
      font-size: 1.8em;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 15px;
    }

    .btn-redeem {
      width: 100%;
      padding: 12px;
      background: var(--success);
      color: var(--white);
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-redeem:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-redeem:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* === ABOUT/CONTACT PAGE === */
    .about-section {
      background: var(--white);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .video-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto 30px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .video-container iframe {
      width: 100%;
      aspect-ratio: 16/9;
      border: none;
    }

    .contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .contact-item {
      background: var(--primary-light);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border-left: 4px solid var(--primary);
    }

    .contact-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .contact-label {
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 5px;
    }

    .contact-value {
      color: var(--text-dark);
      font-size: 1.1em;
    }

    .social-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .social-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      color: var(--white);
      text-decoration: none;
      transition: all 0.3s;
    }

    .social-btn.facebook { background: #1877f2; }
    .social-btn.instagram { background: #e4405f; }
    .social-btn.zalo { background: #0068ff; }

    .social-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    /* === HISTORY === */
    .history-list {
      background: var(--white);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .history-item {
      padding: 15px;
      border-bottom: 1px solid var(--secondary-light);
      border-left: 4px solid var(--primary);
      margin-bottom: 10px;
      background: var(--primary-light);
      border-radius: 5px;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-date {
      color: var(--text-light);
      font-size: 0.9em;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* === LOGIN PAGE === */
    .login-page {
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-card {
      background: var(--white);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 400px;
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .login-logo .logo-icon {
      font-size: 4em;
      margin-bottom: 10px;
    }

    .login-logo h1 {
      color: var(--primary-dark);
      font-size: 2em;
      margin-bottom: 10px;
    }

    .login-logo p {
      color: var(--text-light);
      font-size: 0.9em;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-dark);
      font-weight: 600;
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--secondary-light);
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .hidden {
      display: none !important;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: var(--primary);
      font-size: 1.2em;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-tabs {
        overflow-x: auto;
      }
      
      .tab-btn {
        font-size: 0.9em;
        padding: 12px 15px;
      }
      
      .control-grid {
        grid-template-columns: 1fr;
      }
      
      .control-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-page">
    <div class="login-card">
      <div class="login-logo">
        <div class="logo-icon">üçΩÔ∏è</div>
        <h1>FoodScan Restaurant</h1>
        <p>Nh√† h√†ng th√¥ng minh - T√≠ch ƒëi·ªÉm m·ªói b·ªØa ƒÉn</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label>T√™n ƒëƒÉng nh·∫≠p</label>
          <input type="text" id="username" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" required>
        </div>
        <div class="form-group">
          <label>Email (t√πy ch·ªçn)</label>
          <input type="email" id="email" placeholder="email@example.com">
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">ƒêƒÉng nh·∫≠p</button>
      </form>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp" class="hidden">
    <!-- Header -->
    <div class="app-header">
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <div class="logo-icon">üçΩÔ∏è</div>
            <div class="logo-text">
              <h1>FoodScan Restaurant</h1>
              <p>Nh√† h√†ng th√¥ng minh - T√≠ch ƒëi·ªÉm th∆∞·ªüng h·∫•p d·∫´n</p>
            </div>
          </div>
          <div class="user-info">
            <div class="user-avatar" id="userAvatar">U</div>
            <div>
              <div style="font-weight: 600;" id="displayName">User</div>
              <div style="font-size: 0.9em; color: var(--text-light);">Th√†nh vi√™n</div>
            </div>
            <div class="points-badge">‚≠ê <span id="userPoints">0</span> ƒëi·ªÉm</div>
            <button class="btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="nav-tabs">
      <button class="tab-btn active" onclick="switchTab('scan')">üì∏ Qu√©t m√≥n ƒÉn</button>
      <button class="tab-btn" onclick="switchTab('menu')">üìã Th·ª±c ƒë∆°n</button>
      <button class="tab-btn" onclick="switchTab('rewards')">üéÅ ƒê·ªïi th∆∞·ªüng</button>
      <button class="tab-btn" onclick="switchTab('history')">üìä L·ªãch s·ª≠</button>
      <button class="tab-btn" onclick="switchTab('about')">‚ÑπÔ∏è V·ªÅ ch√∫ng t√¥i</button>
    </div>

    <div class="container">
      <!-- SCAN TAB -->
      <div id="scanTab" class="tab-content active">
        <div class="scan-area">
          <h2 class="section-title">üì∏ Qu√©t Khay ƒÇn C·ªßa B·∫°n</h2>
          <div class="camera-container">
            <img id="preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='450'%3E%3Crect width='600' height='450' fill='%23f5f5f5'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999' font-size='24'%3ECh·ª•p ·∫£nh khay ƒÉn%3C/text%3E%3C/svg%3E" alt="Preview">
          </div>
          
          <!-- Camera Controls -->
          <div class="camera-controls">
            <button class="btn btn-primary" onclick="startCamera()">üé• B·∫≠t camera</button>
            <button class="btn btn-primary" onclick="capturePhoto()">üì∏ Ch·ª•p ·∫£nh</button>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <button class="btn btn-secondary" onclick="document.getElementById('imageInput').click()">üìÅ T·∫£i ·∫£nh</button>
            <button class="btn btn-primary" onclick="analyzeImage()" id="analyzeBtn" style="background: var(--success);" disabled>‚ú® Ph√¢n t√≠ch</button>
          </div>

          <!-- Image Controls -->
          <div class="image-controls" id="imageControls">
            <h4>üé® Ch·ªânh s·ª≠a ·∫£nh</h4>
            <div class="control-grid">
              <div class="control-item">
                <label>üîÜ ƒê·ªô s√°ng: <span id="brightnessValue">0</span>%</label>
                <input type="range" id="brightnessSlider" min="-100" max="100" value="0" oninput="adjustBrightness(this.value)">
              </div>
              <div class="control-item">
                <label>‚ö° ƒê·ªô t∆∞∆°ng ph·∫£n: <span id="contrastValue">0</span>%</label>
                <input type="range" id="contrastSlider" min="-100" max="100" value="0" oninput="adjustContrast(this.value)">
              </div>
            </div>
            <div class="control-buttons">
              <button class="btn btn-primary" onclick="applyAdjustments()" style="background: var(--success);">‚úÖ √Åp d·ª•ng</button>
              <button class="btn btn-secondary" onclick="resetAdjustments()">üîÑ Reset</button>
              <button class="btn btn-secondary" onclick="showOriginalImage()">üëÅÔ∏è Xem g·ªëc</button>
            </div>
          </div>

          <div id="loadingArea" class="loading hidden">ƒêang ph√¢n t√≠ch...</div>
          <div id="resultsArea" class="results-area hidden">
            <!-- Results will be populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- MENU TAB -->
      <div id="menuTab" class="tab-content">
        <h2 class="section-title">üìã Th·ª±c ƒë∆°n nh√† h√†ng</h2>
        <div class="menu-grid" id="menuGrid"></div>
      </div>

      <!-- REWARDS TAB -->
      <div id="rewardsTab" class="tab-content">
        <h2 class="section-title">üéÅ ƒê·ªïi qu√† t·∫∑ng</h2>
        <div class="rewards-grid" id="rewardsGrid"></div>
      </div>

      <!-- HISTORY TAB -->
      <div id="historyTab" class="tab-content">
        <h2 class="section-title">üìä L·ªãch s·ª≠ giao d·ªãch</h2>
        <div class="history-list" id="historyList"></div>
      </div>

      <!-- ABOUT/CONTACT TAB -->
      <div id="aboutTab" class="tab-content">
        <div class="about-section">
          <h2 class="section-title">‚ÑπÔ∏è Gi·ªõi thi·ªáu v·ªÅ nh√† h√†ng</h2>
          
          <!-- Video Introduction -->
          <div class="video-container">
            <iframe 
              src="https://www.youtube.com/embed/dQw4w9WgXcQ" 
              title="Video gi·ªõi thi·ªáu nh√† h√†ng"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
            </iframe>
          </div>
          
          <p style="line-height: 1.8; color: var(--text-dark); margin-bottom: 30px;">
            Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi <strong>FoodScan Restaurant</strong> - nh√† h√†ng ti√™n phong ·ª©ng d·ª•ng c√¥ng ngh·ªá AI 
            trong vi·ªác nh·∫≠n di·ªán m√≥n ƒÉn v√† t√≠ch ƒëi·ªÉm th∆∞·ªüng t·ª± ƒë·ªông. V·ªõi h·ªá th·ªëng qu√©t khay th√¥ng minh, 
            m·ªói b·ªØa ƒÉn c·ªßa b·∫°n ƒë·ªÅu ƒë∆∞·ª£c ghi nh·∫≠n v√† quy ƒë·ªïi th√†nh ƒëi·ªÉm th∆∞·ªüng h·∫•p d·∫´n.
          </p>
          
          <h3 class="section-title">üìû Th√¥ng tin li√™n h·ªá</h3>
          <div class="contact-grid">
            <div class="contact-item">
              <div class="contact-icon">üìç</div>
              <div class="contact-label">ƒê·ªãa ch·ªâ</div>
              <div class="contact-value">123 Nguy·ªÖn Hu·ªá, Q1, TP.HCM</div>
            </div>
            <div class="contact-item">
              <div class="contact-icon">üìû</div>
              <div class="contact-label">ƒêi·ªán tho·∫°i</div>
              <div class="contact-value">028 1234 5678</div>
            </div>
            <div class="contact-item">
              <div class="contact-icon">‚úâÔ∏è</div>
              <div class="contact-label">Email</div>
              <div class="contact-value">info@foodscan.vn</div>
            </div>
            <div class="contact-item">
              <div class="contact-icon">üïê</div>
              <div class="contact-label">Gi·ªù m·ªü c·ª≠a</div>
              <div class="contact-value">6:00 - 22:00 (H√†ng ng√†y)</div>
            </div>
          </div>
          
          <h3 class="section-title" style="margin-top: 30px;">üåê K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h3>
          <div class="social-links">
            <a href="#" class="social-btn facebook" title="Facebook">üìò</a>
            <a href="#" class="social-btn instagram" title="Instagram">üì∑</a>
            <a href="#" class="social-btn zalo" title="Zalo">üí¨</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // JavaScript code remains the same as in the original
    // Only the CSS has been updated for a more professional layout
    let cameraActive = false;
    let videoStream = null;
    let currentUser = null;
    let currentImage = null;
    const API_URL = 'http://localhost:5000/api';

    // Menu data
    const MENU_DATA = {
      'Canh chua c√≥ c√°': { image: 'images/canh_chua_ca.png', price: 25000, calories: 80 },
      'Canh chua kh√¥ng c√°': { image: 'images/canh_chua.png', price: 10000, calories: 70 },
      'Canh rau c·∫£i': { image: 'images/canh_rau_cai.png', price: 7000, calories: 50 },
      'Canh rau mu·ªëng': { image: 'images/canh_rau_muong.png', price: 7000, calories: 40 },
      'C√° h√∫ kho': { image: 'images/ca_hu_kho.png', price: 30000, calories: 150 },
      'C∆°m tr·∫Øng': { image: 'images/com.png', price: 10000, calories: 200 },
      'C·ªß s·∫Øn x√†o': { image: 'images/cu_san_xao.png', price: 10000, calories: 100 },
      'Khay tr·ªëng': { image: 'images/khay_trong.png', price: 0, calories: 0 },
      'Lagim x√†o': { image: 'images/lagim_xao.png', price: 10000, calories: 120 },
      'S∆∞·ªùn n∆∞·ªõng': { image: 'images/suon_nuong.png', price: 30000, calories: 300 },
      'Th·ªãt kho': { image: 'images/thit_kho.png', price: 25000, calories: 250 },
      'Th·ªãt kho 1 tr·ª©ng': { image: 'images/thit_kho_1_trung.png', price: 30000, calories: 300 },
      'Th·ªãt kho 2 tr·ª©ng': { image: 'images/thit_kho_2_trung.png', price: 36000, calories: 350 },
      'Tr·ª©ng chi√™n': { image: 'images/trung_chien.png', price: 25000, calories: 150 },
      'ƒê·∫≠u h·ªß s·ªët c√†': { image: 'images/dau_hu_sot_ca.png', price: 25000, calories: 100 },
      'ƒê·∫≠u que x√†o': { image: 'images/dau_que_xao.png', price: 10000, calories: 80 },
      'ƒê·∫≠u ƒë≈©a x√†o': { image: 'images/dau_dua_xao.png', price: 10000, calories: 90 }
    };

    const REWARDS_DATA = {
      1: { name: 'Gi·∫£m 10%', points: 50, image: 'images/reward_10.png' },
      2: { name: 'N∆∞·ªõc ng·ªçt', points: 30, image: 'images/reward_drink.png' },
      3: { name: 'Tr√† s·ªØa', points: 80, image: 'images/reward_tea.png' },
      4: { name: 'Gi·∫£m 20%', points: 100, image: 'images/reward_20.png' },
      5: { name: 'Combo Set', points: 150, image: 'images/reward_combo.png' },
      6: { name: 'Buffet', points: 300, image: 'images/reward_buffet.png' }
    };

    // Login handling
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      if (username) {
        currentUser = {
          id: username.toLowerCase().replace(/\s+/g, '_'),
          name: username,
          points: 0
        };
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('displayName').textContent = username;
        document.getElementById('userAvatar').textContent = username[0].toUpperCase();
        await loadUserPoints();
        loadMenu();
        loadRewards();
      }
    });

    function logout() {
      currentUser = null;
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginForm').reset();
    }

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      if (tabName === 'history') {
        loadHistory();
      }
    }

    // Camera functions
    async function startCamera() {
      const container = document.querySelector('.camera-container');

      if (cameraActive && videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        cameraActive = false;

        container.innerHTML = `
          <img id="preview"
               src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='450'%3E
               %3Crect width='600' height='450' fill='%23f5f5f5'/%3E
               %3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999' font-size='24'%3E
               Ch·ª•p ·∫£nh khay ƒÉn%3C/text%3E%3C/svg%3E"
               alt="Preview"
               style="width:100%;height:100%;object-fit:cover;">
        `;
        document.querySelector(".camera-controls button[onclick='startCamera()']").textContent = "üé• B·∫≠t camera";
        return;
      }

      container.innerHTML = `
        <video id="cameraStream" autoplay playsinline style="width:100%;height:100%;object-fit:cover;"></video>
        <canvas id="cameraCanvas" class="hidden"></canvas>
      `;
      try {
        videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        document.getElementById('cameraStream').srcObject = videoStream;
        cameraActive = true;
        document.querySelector(".camera-controls button[onclick='startCamera()']").textContent = "‚õî T·∫Øt camera";
      } catch (err) {
        alert('Kh√¥ng th·ªÉ b·∫≠t camera: ' + err.message);
      }
    }

    async function capturePhoto() {
        const video = document.getElementById("cameraStream");
        const canvas = document.getElementById("cameraCanvas");

        if (!video || !canvas) {
            alert("‚ö†Ô∏è Vui l√≤ng b·∫≠t camera tr∆∞·ªõc khi ch·ª•p!");
            return;
        }

        if (video.videoWidth === 0 || video.videoHeight === 0) {
            await new Promise(resolve => setTimeout(resolve, 500));
        }

        const width = video.videoWidth;
        const height = video.videoHeight;
        if (width === 0 || height === 0) {
            alert("‚ö†Ô∏è Camera ch∆∞a s·∫µn s√†ng! Th·ª≠ l·∫°i sau 1 gi√¢y.");
            return;
        }

        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, width, height);

        const imageData = canvas.toDataURL("image/jpeg");
        currentImage = imageData;

        videoStream.getTracks().forEach(track => track.stop());
        cameraActive = false;

        const container = document.querySelector('.camera-container');
        container.innerHTML = `
            <img id="preview" src="${imageData}" style="width:100%;height:100%;object-fit:cover;">
        `;

        document.querySelector(".camera-controls button[onclick='startCamera()']").textContent = "üé• B·∫≠t camera";
        document.getElementById("analyzeBtn").disabled = false;

        document.getElementById('imageControls').style.display = 'block';

        alert("üì∑ ƒê√£ ch·ª•p ·∫£nh th√†nh c√¥ng!");
    }

    // Image handling
    document.getElementById('imageInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const targetWidth = 800;
                const targetHeight = 600;

                const canvas = document.createElement('canvas');
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d');

                const scale = Math.min(targetWidth / img.width, targetHeight / img.height);
                const x = (targetWidth - img.width * scale) / 2;
                const y = (targetHeight - img.height * scale) / 2;

                ctx.fillStyle = "#f5f5f5";
                ctx.fillRect(0, 0, targetWidth, targetHeight);
                ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

                currentImage = canvas.toDataURL('image/jpeg', 0.9);

                const preview = document.getElementById('preview');
                preview.src = currentImage;
                document.getElementById('analyzeBtn').disabled = false;

                document.getElementById('imageControls').style.display = 'block';
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    async function analyzeImage() {
      if (!currentImage || !currentUser) return;
      
      document.getElementById('loadingArea').classList.remove('hidden');
      document.getElementById('resultsArea').classList.add('hidden');
      
      try {
        const response = await fetch(`${API_URL}/analyze`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            image: currentImage,
            user_id: currentUser.id
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          displayResults(data);
          currentUser.points = data.total_points;
          document.getElementById('userPoints').textContent = currentUser.points;
        } else {
          alert('L·ªói: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server');
      }
      
      document.getElementById('loadingArea').classList.add('hidden');
    }

    function displayResults(data) {
        document.getElementById('resultsArea').innerHTML = `
            <h3 class="section-title">üñºÔ∏è H√¨nh ·∫£nh v·ªõi c√°c v√πng ƒë√£ c·∫Øt</h3>
            <div id="originalImageContainer" style="margin-bottom: 30px; text-align: center;"></div>
            
            <h3 class="section-title">üçΩÔ∏è 5 v√πng ƒë√£ c·∫Øt t·ª´ khay</h3>
            <div id="segmentsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;"></div>
            
            <h3 class="section-title">üìä K·∫øt qu·∫£ ph√¢n t√≠ch</h3>
            <div id="foodsList"></div>
            <div class="total-summary">
                <div class="total-row">
                    <span>T·ªïng ti·ªÅn:</span>
                    <span id="totalPrice">0ƒë</span>
                </div>
                <div class="total-row" style="font-size: 1em;">
                    <span>T·ªïng calo:</span>
                    <span id="totalCalories">0 cal</span>
                </div>
                <div class="total-row" style="color: var(--accent);">
                    <span>ƒêi·ªÉm t√≠ch l≈©y:</span>
                    <span id="pointsEarned">+0 ƒëi·ªÉm</span>
                </div>
            </div>
            <div id="nutritionAnalysis" style="margin-top: 20px; padding: 20px; background: var(--white); border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);"></div>
        `;

        // Hi·ªÉn th·ªã ·∫£nh g·ªëc v·ªõi bounding boxes
        displayOriginalImageWithBoxes(data);
        
        // Hi·ªÉn th·ªã c√°c segments ri√™ng l·∫ª
        displaySegments(data);
        
        const foodsList = document.getElementById('foodsList');
        const detectedFoods = data.foods.filter(food => 
            food.name !== 'Kh√¥ng c√≥ m√≥n ƒÉn n√†o c·∫£' && 
            !food.name.toLowerCase().includes('kh√¥ng c√≥')
        );
        
        if (detectedFoods.length === 0) {
            foodsList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-light); background: var(--primary-light); border-radius: 10px;">
                    <div style="font-size: 3em; margin-bottom: 10px;">üçΩÔ∏è</div>
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Kh√¥ng ph√°t hi·ªán m√≥n ƒÉn n√†o</div>
                    <div>H√£y th·ª≠ ch·ª•p l·∫°i ·∫£nh khay ƒÉn v·ªõi √°nh s√°ng t·ªët h∆°n</div>
                </div>
            `;
        } else {
            detectedFoods.forEach(food => {
                const item = document.createElement('div');
                item.className = 'food-item';
                item.innerHTML = `
                    <div>
                        <h3>${food.name}</h3>
                        <div style="color: var(--text-light); font-size: 0.9em;">√î ${food.position} - ${(food.confidence * 100).toFixed(1)}% tin c·∫≠y</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="food-price">${food.price.toLocaleString()}ƒë</div>
                        <div style="color: var(--text-light); font-size: 0.9em;">${food.calories} cal</div>
                    </div>
                `;
                foodsList.appendChild(item);
            });
        }
        
        // T√≠nh t·ªïng ch·ªâ t·ª´ c√°c m√≥n ƒÉn th·ª±c s·ª± ƒë∆∞·ª£c ph√°t hi·ªán
        const totalPrice = detectedFoods.reduce((sum, food) => sum + food.price, 0);
        const totalCalories = detectedFoods.reduce((sum, food) => sum + food.calories, 0);
        const pointsEarned = Math.floor(totalPrice / 10000);
        
        document.getElementById('totalPrice').textContent = totalPrice.toLocaleString() + 'ƒë';
        document.getElementById('totalCalories').textContent = totalCalories + ' cal';
        document.getElementById('pointsEarned').textContent = '+' + pointsEarned + ' ƒëi·ªÉm';
        
        displayNutritionAnalysis(totalCalories, detectedFoods);
        
        document.getElementById('resultsArea').classList.remove('hidden');
    }

    function displayOriginalImageWithBoxes(data) {
        const container = document.getElementById('originalImageContainer');
        
        // T·∫°o canvas ƒë·ªÉ v·∫Ω bounding boxes
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // T·∫°o h√¨nh ·∫£nh t·ª´ base64
        const img = new Image();
        img.onload = function() {
            // ƒê·∫∑t k√≠ch th∆∞·ªõc canvas b·∫±ng k√≠ch th∆∞·ªõc ·∫£nh (nh∆∞ng scale xu·ªëng ƒë·ªÉ hi·ªÉn th·ªã)
            const maxWidth = 600;
            const scale = maxWidth / img.width;
            canvas.width = maxWidth;
            canvas.height = img.height * scale;
            
            // V·∫Ω ·∫£nh g·ªëc ƒë√£ scale
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // V·∫Ω bounding boxes cho t·ª´ng segment
            if (data.segments && data.segments.length > 0) {
                data.segments.forEach((segment, index) => {
                    if (segment.box) {
                        drawBoundingBox(ctx, segment.box, index + 1, segment.prediction.name, scale);
                    }
                });
            }
            
            // Hi·ªÉn th·ªã canvas
            canvas.style.maxWidth = '100%';
            canvas.style.height = 'auto';
            canvas.style.border = '2px solid var(--primary)';
            canvas.style.borderRadius = '10px';
            canvas.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
        };
        
        img.src = currentImage;
        container.appendChild(canvas);
    }

    function drawBoundingBox(ctx, box, position, foodName, scale) {
        const [x1, y1, x2, y2] = box.map(coord => coord * scale);
        const width = x2 - x1;
        const height = y2 - y1;
        
        // M√†u s·∫Øc cho bounding box (m√†u kh√°c nhau cho m·ªói v·ªã tr√≠)
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57'];
        const color = colors[(position - 1) % colors.length];
        
        // V·∫Ω bounding box
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.strokeRect(x1, y1, width, height);
        
        // V·∫Ω background cho label
        const label = `√î ${position}: ${foodName}`;
        ctx.font = 'bold 14px Arial';
        const textWidth = ctx.measureText(label).width;
        const textHeight = 20;
        
        // ƒê·∫∑t v·ªã tr√≠ label
        let labelX = x1;
        let labelY = y1 - 10;
        
        // ƒê·∫£m b·∫£o label kh√¥ng v∆∞·ª£t ra ngo√†i canvas
        if (labelY < 20) {
            labelY = y1 + 25;
        }
        if (labelX + textWidth > ctx.canvas.width) {
            labelX = ctx.canvas.width - textWidth - 5;
        }
        
        // V·∫Ω background label
        ctx.fillStyle = color + 'CC'; // Th√™m ƒë·ªô trong su·ªët
        ctx.fillRect(labelX - 5, labelY - 15, textWidth + 10, textHeight);
        
        // V·∫Ω text
        ctx.fillStyle = 'white';
        ctx.fillText(label, labelX, labelY);
        
        // V·∫Ω s·ªë th·ª© t·ª± ·ªü g√≥c
        ctx.fillStyle = color;
        ctx.fillRect(x1, y1, 25, 25);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(position.toString(), x1 + 12.5, y1 + 12.5);
    }

    function displaySegments(data) {
        const segmentsGrid = document.getElementById('segmentsGrid');
        segmentsGrid.innerHTML = '';
        
        if (data.segments && data.segments.length > 0) {
            data.segments.forEach((segment, index) => {
                const segmentCard = document.createElement('div');
                segmentCard.className = 'segment-card';
                segmentCard.style.background = 'var(--white)';
                segmentCard.style.borderRadius = '10px';
                segmentCard.style.overflow = 'hidden';
                segmentCard.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                segmentCard.style.transition = 'all 0.3s';
                
                segmentCard.innerHTML = `
                    <div style="position: relative;">
                        <img src="${segment.image}" alt="Segment ${index + 1}" 
                             style="width: 100%; height: 120px; object-fit: cover; background: #f5f5f5;">
                        <div style="position: absolute; top: 5px; left: 5px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.85em; font-weight: 600;">
                            √î ${index + 1}
                        </div>
                    </div>
                    <div style="padding: 10px; text-align: center;">
                        <div style="font-weight: 600; color: var(--text-dark); font-size: 0.9em; margin-bottom: 5px;">
                            ${segment.prediction.name}
                        </div>
                        <div style="font-size: 0.8em; color: ${segment.prediction.confidence > 0.5 ? '#28a745' : '#dc3545'};">
                            ${(segment.prediction.confidence * 100).toFixed(1)}% tin c·∫≠y
                        </div>
                    </div>
                `;
                
                segmentsGrid.appendChild(segmentCard);
            });
        }
    }

    function displayNutritionAnalysis(totalCalories, foods) {
      const analysisDiv = document.getElementById('nutritionAnalysis');
      
      const dailyRecommended = 2000;
      const mealRecommended = dailyRecommended / 3;
      const percentage = ((totalCalories / mealRecommended) * 100).toFixed(1);
      
      // S·ª≠a l·ªói ·ªü ƒë√¢y - thay th·∫ø var() b·∫±ng gi√° tr·ªã tr·ª±c ti·∫øp
      let status, statusColor, statusIcon, statusBg, advice;
      if (totalCalories < 400) {
        status = 'Thi·∫øu calo';
        statusColor = '#FFC107'; // var(--warning)
        statusIcon = '‚ö†Ô∏è';
        statusBg = '#fff8e1';
        advice = 'B·ªØa ƒÉn c·ªßa b·∫°n kh√° nh·∫π. H√£y b·ªï sung th√™m protein ho·∫∑c carbohydrate ƒë·ªÉ ƒë·ªß nƒÉng l∆∞·ª£ng.';
      } else if (totalCalories >= 400 && totalCalories <= 800) {
        status = 'C√¢n ƒë·ªëi t·ªët';
        statusColor = '#4CAF50'; // var(--success)
        statusIcon = '‚úÖ';
        statusBg = '#e8f5e9';
        advice = 'B·ªØa ƒÉn c√¢n ƒë·ªëi! B·∫°n ƒëang cung c·∫•p ƒë·ªß nƒÉng l∆∞·ª£ng cho c∆° th·ªÉ m√† kh√¥ng qu√° nhi·ªÅu.';
      } else if (totalCalories > 800 && totalCalories <= 1000) {
        status = 'H∆°i nhi·ªÅu calo';
        statusColor = '#ff9800';
        statusIcon = '‚ö°';
        statusBg = '#fff3e0';
        advice = 'B·ªØa ƒÉn h∆°i nhi·ªÅu calo. N·∫øu kh√¥ng v·∫≠n ƒë·ªông nhi·ªÅu, h√£y gi·∫£m l∆∞·ª£ng ƒÉn ho·∫∑c tƒÉng rau xanh.';
      } else {
        status = 'Qu√° nhi·ªÅu calo';
        statusColor = '#F44336'; // var(--error)
        statusIcon = '‚ùå';
        statusBg = '#ffebee';
        advice = 'B·ªØa ƒÉn c√≥ qu√° nhi·ªÅu calo! H√£y c√¢n nh·∫Øc gi·∫£m c√°c m√≥n nhi·ªÅu d·∫ßu m·ª° v√† tƒÉng rau xanh.';
      }
      
      let hasRice = false, hasVegetables = false, hasProtein = false, hasSoup = false;
      
      foods.forEach(food => {
        const name = food.name.toLowerCase();
        if (name.includes('c∆°m')) hasRice = true;
        if (name.includes('rau') || name.includes('canh')) {
          if (name.includes('canh')) hasSoup = true;
          else hasVegetables = true;
        }
        if (name.includes('th·ªãt') || name.includes('c√°') || name.includes('s∆∞·ªùn') || 
          name.includes('tr·ª©ng') || name.includes('ƒë·∫≠u')) {
          hasProtein = true;
        }
      });
      
      const balanceItems = [];
      if (hasRice) balanceItems.push({ icon: 'üçö', text: 'Carbohydrate', color: '#2196F3' });
      if (hasProtein) balanceItems.push({ icon: 'ü•©', text: 'Protein', color: '#F44336' });
      if (hasVegetables) balanceItems.push({ icon: 'ü•¨', text: 'Rau xanh', color: '#4CAF50' });
      if (hasSoup) balanceItems.push({ icon: 'üç≤', text: 'Canh/S√∫p', color: '#FF9800' });
      
      const missingItems = [];
      if (!hasRice) missingItems.push('üçö C∆°m/Carbohydrate');
      if (!hasProtein) missingItems.push('ü•© Protein');
      if (!hasVegetables) missingItems.push('ü•¨ Rau xanh');
      if (!hasSoup) missingItems.push('üç≤ Canh/N∆∞·ªõc');
      
      analysisDiv.innerHTML = `
        <h3 style="margin-bottom: 15px; color: var(--text-dark);">üìä Ph√¢n t√≠ch dinh d∆∞·ª°ng</h3>
        
        <div style="background: ${statusBg}; padding: 15px; border-radius: 10px; border-left: 4px solid ${statusColor}; margin-bottom: 15px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <span style="font-size: 1.5em;">${statusIcon}</span>
            <div>
              <div style="font-weight: 600; font-size: 1.1em; color: ${statusColor};">${status}</div>
              <div style="font-size: 0.9em; color: var(--text-light);">${totalCalories} cal / ${mealRecommended.toFixed(0)} cal khuy·∫øn ngh·ªã</div>
            </div>
          </div>
          <div style="background: var(--white); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
            <div style="height: 100%; background: ${statusColor}; width: ${Math.min(percentage, 100)}%; transition: width 0.5s;"></div>
          </div>
          <div style="font-size: 0.9em; color: var(--text-dark);">${advice}</div>
        </div>
        
        <div style="margin-bottom: 15px;">
          <div style="font-weight: 600; margin-bottom: 10px; color: var(--text-dark);">‚úÖ Th√†nh ph·∫ßn c√≥ trong b·ªØa ƒÉn:</div>
          <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            ${balanceItems.map(item => `
              <div style="background: ${item.color}20; padding: 8px 15px; border-radius: 20px; border: 2px solid ${item.color}; display: flex; align-items: center; gap: 5px;">
                <span>${item.icon}</span>
                <span style="font-weight: 600; color: ${item.color};">${item.text}</span>
              </div>
            `).join('')}
          </div>
        </div>
        
        ${missingItems.length > 0 ? `
        <div style="margin-bottom: 15px;">
          <div style="font-weight: 600; margin-bottom: 10px; color: #ff9800;">‚ö†Ô∏è N√™n b·ªï sung:</div>
          <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            ${missingItems.map(item => `
              <div style="background: #fff3e0; padding: 8px 15px; border-radius: 20px; border: 2px dashed #ff9800; color: #ff9800; font-weight: 600;">
                ${item}
              </div>
            `).join('')}
          </div>
        </div>
        ` : '<div style="color: #4CAF50; font-weight: 600; padding: 10px; background: #e8f5e9; border-radius: 8px;">üéâ B·ªØa ƒÉn ƒë·∫ßy ƒë·ªß d∆∞·ª°ng ch·∫•t!</div>'}
        
        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196F3;">
          <div style="font-weight: 600; margin-bottom: 8px; color: #1976d2;">üí° M·∫πo s·ª©c kh·ªèe:</div>
          <ul style="margin: 0; padding-left: 20px; color: var(--text-dark);">
            <li>N√™n ƒÉn nhi·ªÅu rau xanh (√≠t nh·∫•t 1/2 khay)</li>
            <li>U·ªëng ƒë·ªß n∆∞·ªõc (2 l√≠t/ng√†y)</li>
            <li>H·∫°n ch·∫ø ƒë·ªì chi√™n r√°n, th·ª©c ƒÉn nhi·ªÅu d·∫ßu m·ª°</li>
            <li>ƒÇn ch·∫≠m v√† nhai k·ªπ ƒë·ªÉ ti√™u h√≥a t·ªët h∆°n</li>
          </ul>
        </div>
      `;
    }

    async function loadUserPoints() {
      try {
        const response = await fetch(`${API_URL}/user/${currentUser.id}/points`);
        const data = await response.json();
        if (data.success) {
          currentUser.points = data.total_points;
          document.getElementById('userPoints').textContent = currentUser.points;
        }
      } catch (error) {
        console.error('Error loading points:', error);
      }
    }
   
    function loadMenu() {
      const grid = document.getElementById('menuGrid');
      grid.innerHTML = '';
      
      Object.entries(MENU_DATA).forEach(([name, info]) => {
        const card = document.createElement('div');
        card.className = 'menu-card';
        card.innerHTML = `
          <div class="menu-card-img">
            <img src="${info.image}" alt="${name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2216%22%3E${name}%3C/text%3E%3C/svg%3E'">
          </div>
          <div class="menu-card-body">
            <div class="menu-card-title">${name}</div>
            <div class="menu-card-info">
              <span class="menu-price">${info.price.toLocaleString()}ƒë</span>
              <span>üî• ${info.calories} cal</span>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function loadRewards() {
      const grid = document.getElementById('rewardsGrid');
      grid.innerHTML = '';
      
      Object.entries(REWARDS_DATA).forEach(([id, reward]) => {
        const card = document.createElement('div');
        card.className = 'reward-card';
        const canRedeem = currentUser.points >= reward.points;
        card.innerHTML = `
          <div class="reward-icon">
            <img src="${reward.image}" alt="${reward.name}" onerror="this.parentElement.innerHTML='üéÅ'">
          </div>
          <div class="reward-title">${reward.name}</div>
          <div class="reward-points">${reward.points} ƒëi·ªÉm</div>
          <button class="btn-redeem" onclick="redeemReward(${id}, ${reward.points})" ${!canRedeem ? 'disabled' : ''}>
            ${canRedeem ? 'üéÅ ƒê·ªïi ngay' : 'üîí Ch∆∞a ƒë·ªß ƒëi·ªÉm'}
          </button>
        `;
        grid.appendChild(card);
      });
    }

    async function redeemReward(rewardId, points) {
      if (!currentUser) {
        alert('‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
        return;
      }
      if (currentUser.points < points) {
        alert('‚ùå B·∫°n kh√¥ng ƒë·ªß ƒëi·ªÉm ƒë·ªÉ ƒë·ªïi qu√† n√†y!');
        return;
      }
      if (!confirm(`üéÅ B·∫°n mu·ªën ƒë·ªïi qu√† n√†y v·ªõi ${points} ƒëi·ªÉm?`)) return;
      try {
        const response = await fetch(`${API_URL}/redeem`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: currentUser.id,
            points: points
          })
        });
        const data = await response.json();
        if (data.success) {
          alert('üéâ ' + data.message);
          currentUser.points = data.remaining_points;
          document.getElementById('userPoints').textContent = currentUser.points;
          loadRewards();
        } else {
          alert('‚ùå L·ªói: ' + data.error);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server');
      }
    }

    async function loadHistory() {
      const list = document.getElementById('historyList');
      list.innerHTML = '<div class="loading">ƒêang t·∫£i...</div>';
      
      try {
        const response = await fetch(`${API_URL}/user/${currentUser.id}/history`);
        const data = await response.json();
        
        list.innerHTML = '';
        if (data.history && data.history.length > 0) {
          data.history.reverse().forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            const date = new Date(item.timestamp).toLocaleString('vi-VN');
            historyItem.innerHTML = `
              <div class="history-date">üìÖ ${date}</div>
              <div style="font-weight: 600; margin-bottom: 10px;">üçΩÔ∏è ${item.foods.length} m√≥n ƒÉn</div>
              <div style="display: flex; justify-content: space-between;">
                <span>üí∞ T·ªïng ti·ªÅn: <strong>${item.total_price.toLocaleString()}ƒë</strong></span>
                <span style="color: var(--accent); font-weight: 600;">‚≠ê +${item.points_earned} ƒëi·ªÉm</span>
              </div>
            `;
            list.appendChild(historyItem);
          });
        } else {
          list.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-light);">Ch∆∞a c√≥ l·ªãch s·ª≠</div>';
        }
      } catch (error) {
        console.error('Error:', error);
        list.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-light);">Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠</div>';
      }
    }

    // Image adjustment functions
    let currentBrightness = 0;
    let currentContrast = 0;

    function adjustBrightness(value) {
        currentBrightness = parseInt(value);
        document.getElementById('brightnessValue').textContent = value;
        previewAdjustments();
    }

    function adjustContrast(value) {
        currentContrast = parseInt(value);
        document.getElementById('contrastValue').textContent = value;
        previewAdjustments();
    }

    function previewAdjustments() {
        if (!currentImage) return;
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.filter = `brightness(${100 + currentBrightness}%) contrast(${100 + currentContrast}%)`;
            ctx.drawImage(img, 0, 0);
            document.getElementById('preview').src = canvas.toDataURL('image/jpeg');
        };
        img.src = currentImage;
    }

    function applyAdjustments() {
        if (!currentImage) return;
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.filter = `brightness(${100 + currentBrightness}%) contrast(${100 + currentContrast}%)`;
            ctx.drawImage(img, 0, 0);
            currentImage = canvas.toDataURL('image/jpeg');
            document.getElementById('preview').src = currentImage;
            alert('‚úÖ ƒê√£ √°p d·ª•ng ch·ªânh s·ª≠a!');
        };
        img.src = currentImage;
    }

    function resetAdjustments() {
        currentBrightness = 0;
        currentContrast = 0;
        document.getElementById('brightnessSlider').value = 0;
        document.getElementById('contrastSlider').value = 0;
        document.getElementById('brightnessValue').textContent = '0';
        document.getElementById('contrastValue').textContent = '0';
        
        if (currentImage) {
            document.getElementById('preview').src = currentImage;
        }
        alert('üîÑ ƒê√£ reset v·ªÅ ·∫£nh g·ªëc!');
    }

    function showOriginalImage() {
        if (!currentImage) return;
        
        const originalImg = new Image();
        originalImg.onload = function() {
            const preview = document.getElementById('preview');
            preview.src = currentImage;
            setTimeout(() => {
                if (currentBrightness !== 0 || currentContrast !== 0) {
                    previewAdjustments();
                }
            }, 3000);
        };
        originalImg.src = currentImage;
    }
  </script>
</body>
</html>
